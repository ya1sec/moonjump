<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Moonjump</title>
  <!--  Essential META Tags -->
  <meta property="og:title" content="Moonjump">
  <meta property="og:type" content="app" />
  <meta property="og:image" content="https://raw.githubusercontent.com/ya1sec/moonjump/main/static/assets/moonjump.png">
  <meta property="og:image:width" content="200">
  <meta property="og:image:height" content="200">
  <meta property="og:url" content="https://moonjump.app">
  <meta property="og:description" content="A server that redirects you to a random page.">
  <meta property="og:site_name" content="Moonjump">
  <meta name="twitter:image:alt" content="Moonjump">
  <meta name="twitter:card" content="https://raw.githubusercontent.com/ya1sec/moonjump/main/static/assets/moonjump.png">
  <!-- Meta tags -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Add Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- CSS -->
  <link rel="stylesheet" type="text/css" media="screen" href="/static/assets/css/hack.css" />
  <link rel="stylesheet" type="text/css" href="/static/assets/css/orb.css" />
  <link rel="icon" type="image/png"
    href="https://raw.githubusercontent.com/ya1sec/moonjump/main/static/assets/moonjump.png" />
  <!-- Add custom Tailwind config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'neon-red': '#ff0033',
          },
        },
      },
    }
  </script>
  <script src="/static/assets/js/orb.js"></script>
</head>

<body>
  <!-- Add this div right after the <body> tag -->
  <div class="loading-overlay">
    <img src="https://melonking.net/universe/melozorbs/images/dolorg.gif" alt="Loading..." style="width: 50px;">
  </div>

  <!-- Top Toolbar -->
  <div id="top-toolbar">
    <div class="toolbar-top-container">
      <div class="relative flex items-center">
        <input type="search" id="search-bar" placeholder="Search..." class="pe-10">
        <span class="absolute inset-y-0 end-3 grid place-content-center">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="w-4 h-4 text-gray-500">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
          </svg>
        </span>
      </div>
      <button id="info-button" class="toolbar-button info-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 15 15" fill="none">
          <path
            d="M7.5 1C3.91015 1 1 3.91015 1 7.5C1 11.0899 3.91015 14 7.5 14C11.0899 14 14 11.0899 14 7.5C14 3.91015 11.0899 1 7.5 1ZM7.5 2C10.5376 2 13 4.46243 13 7.5C13 10.5376 10.5376 13 7.5 13C4.46243 13 2 10.5376 2 7.5C2 4.46243 4.46243 2 7.5 2Z"
            fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" />
          <path
            d="M7 4.5C7 4.22386 7.22386 4 7.5 4C7.77614 4 8 4.22386 8 4.5C8 4.77614 7.77614 5 7.5 5C7.22386 5 7 4.77614 7 4.5Z"
            fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" />
          <path d="M6.5 6H7.5V10H8.5V11H6.5V10H7.5V7H6.5V6Z" fill="currentColor" fill-rule="evenodd"
            clip-rule="evenodd" />
        </svg>
        <span>Info</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div id="main-content">
    <div class="orb-container">
      <div class="glow"></div>
      <div class="orb"></div>
    </div>
    <p class="app-description">Moonjump is a server that redirects you to a random page harvested from the arcane depths
      of the web.</p>
  </div>

  <!-- Jump Result (Iframe) -->
  <div id="jump-result" style="display: none;">
    <button class="close-button">&times;</button>
    <div class="iframe-container">
      <iframe id="jump-iframe" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
    </div>
  </div>

  <!-- Info Section -->
  <div id="info-section" style="display: none;">
    <div id="info-content">
      <div class="info-header">
        <h2>About Moonjump</h2>
        <button id="close-info-button" aria-label="Close info">
          <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12.8536 2.14645C13.0488 2.34171 13.0488 2.65829 12.8536 2.85355L2.85355 12.8536C2.65829 13.0488 2.34171 13.0488 2.14645 12.8536C1.95118 12.6583 1.95118 12.3417 2.14645 12.1464L12.1464 2.14645C12.3417 1.95118 12.6583 1.95118 12.8536 2.14645Z"
              fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" />
            <path
              d="M2.14645 2.14645C2.34171 1.95118 2.65829 1.95118 2.85355 2.14645L12.8536 12.1464C13.0488 12.3417 13.0488 12.6583 12.8536 12.8536C12.6583 13.0488 12.3417 13.0488 12.1464 12.8536L2.14645 2.85355C1.95118 2.65829 1.95118 2.34171 2.14645 2.14645Z"
              fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" />
          </svg>
        </button>
      </div>

      <div class="info-content-body">
        <div class="info-section">
          <h3>What is Moonjump?</h3>
          <p>Moonjump is an experimental web portal that redirects you to unexplored corners of the internet. Each
            "jump" takes you to a random page harvested from the arcane depths of the web, creating a serendipitous
            browsing experience.</p>
        </div>

        <div class="info-section">
          <h3>How It Works</h3>
          <p>When you click the "Jump" button, Moonjump selects a URL from its curated database of interesting, obscure,
            and thought-provoking websites. Some sites will load directly in the embedded viewer, while others will open
            in a new tab for security reasons.</p>
        </div>

        <div class="info-section">
          <h3>Search Function</h3>
          <p>If you're looking for something specific, use the search bar at the top. Moonjump will attempt to find a
            relevant page from its collection that matches your query.</p>
        </div>

        <div class="info-section">
          <h3>Tips</h3>
          <ul class="info-list">
            <li>Click <strong>Jump</strong> to discover random websites</li>
            <li>Use <strong>Search</strong> to find specific content</li>
            <li>Click <strong>Share</strong> to share interesting discoveries</li>
            <li>Press <strong>Close</strong> to return to Moonjump</li>
          </ul>
        </div>

        <div class="info-section">
          <h3>About the Project</h3>
          <p>Moonjump is inspired by the early web experiences of discovery and randomness, before algorithms determined
            everything we see online. It aims to bring back the joy of stumbling upon unexpected content.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Toolbar -->
  <div id="bottom-toolbar">
    <div class="toolbar-buttons">
      <button id="share-button" class="toolbar-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15" fill="none">
          <path
            d="M5 7.5C5 8.32843 4.32843 9 3.5 9C2.67157 9 2 8.32843 2 7.5C2 6.67157 2.67157 6 3.5 6C4.32843 6 5 6.67157 5 7.5Z"
            fill="currentColor" />
          <path
            d="M13 3.5C13 4.32843 12.3284 5 11.5 5C10.6716 5 10 4.32843 10 3.5C10 2.67157 10.6716 2 11.5 2C12.3284 2 13 2.67157 13 3.5Z"
            fill="currentColor" />
          <path
            d="M13 11.5C13 12.3284 12.3284 13 11.5 13C10.6716 13 10 12.3284 10 11.5C10 10.6716 10.6716 10 11.5 10C12.3284 10 13 10.6716 13 11.5Z"
            fill="currentColor" />
          <path d="M4.5 7.5L10.5 4.5M4.5 7.5L10.5 11" stroke="currentColor" />
        </svg>
        <span>Share</span>
      </button>

      <button id="jump-button" class="toolbar-button">
        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M8.14645 3.14645C8.34171 2.95118 8.65829 2.95118 8.85355 3.14645L12.8536 7.14645C13.0488 7.34171 13.0488 7.65829 12.8536 7.85355L8.85355 11.8536C8.65829 12.0488 8.34171 12.0488 8.14645 11.8536C7.95118 11.6583 7.95118 11.3417 8.14645 11.1464L11.2929 8H2.5C2.22386 8 2 7.77614 2 7.5C2 7.22386 2.22386 7 2.5 7H11.2929L8.14645 3.85355C7.95118 3.65829 7.95118 3.34171 8.14645 3.14645Z"
            fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" />
        </svg>
        <span>Jump</span>
      </button>

      <button id="close-button" class="toolbar-button close-button">
        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M12.8536 2.14645C13.0488 2.34171 13.0488 2.65829 12.8536 2.85355L2.85355 12.8536C2.65829 13.0488 2.34171 13.0488 2.14645 12.8536C1.95118 12.6583 1.95118 12.3417 2.14645 12.1464L12.1464 2.14645C12.3417 1.95118 12.6583 1.95118 12.8536 2.14645Z"
            fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" />
          <path
            d="M2.14645 2.14645C2.34171 1.95118 2.65829 1.95118 2.85355 2.14645L12.8536 12.1464C13.0488 12.3417 13.0488 12.6583 12.8536 12.8536C12.6583 13.0488 12.3417 13.0488 12.1464 12.8536L2.14645 2.85355C1.95118 2.65829 1.95118 2.34171 2.14645 2.14645Z"
            fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" />
        </svg>
        <span>Close</span>
      </button>
    </div>
  </div>

  <!-- JavaScript -->
  <script>

    function setVhUnit() {
      let vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }

    window.addEventListener('resize', setVhUnit);
    window.addEventListener('orientationchange', setVhUnit);
    setVhUnit();

    document.addEventListener('DOMContentLoaded', function () {
      const jumpButton = document.getElementById('jump-button');
      const shareButton = document.getElementById('share-button');
      const closeButtons = document.querySelectorAll('.close-button');
      const jumpResult = document.getElementById('jump-result');
      const jumpIframe = document.getElementById('jump-iframe');
      const infoButton = document.getElementById('info-button');
      const searchBar = document.getElementById('search-bar');
      const infoSection = document.getElementById('info-section');
      const closeInfoButton = document.getElementById('close-info-button');

      // Info button functionality
      infoButton.addEventListener('click', function () {
        infoSection.style.display = 'block';
      });

      // Close info button functionality
      closeInfoButton.addEventListener('click', function () {
        infoSection.style.display = 'none';
      });

      // Jump functionality
      jumpButton.addEventListener('click', function () {
        // Add loading state to button
        const originalContent = jumpButton.innerHTML;
        jumpButton.classList.add('loading');
        jumpButton.innerHTML = '<div class="loading-spinner"></div><span class="loading-text">Loading...</span>';
        jumpButton.disabled = true;

        // Show loading overlay
        document.querySelector('.loading-overlay').style.display = 'flex';

        fetch('/jump')
          .then(response => response.json())
          .then(data => {
            if (data.url) {
              if (data.can_embed) {
                jumpIframe.src = data.url;
                jumpResult.style.display = 'block';

                // Add event listener to detect when iframe is loaded
                jumpIframe.onload = function () {
                  // Hide loading overlay
                  document.querySelector('.loading-overlay').style.display = 'none';
                  // Restore button state
                  jumpButton.classList.remove('loading');
                  jumpButton.innerHTML = originalContent;
                  jumpButton.disabled = false;
                };

                // Add timeout in case iframe fails to load
                setTimeout(() => {
                  if (jumpButton.classList.contains('loading')) {
                    document.querySelector('.loading-overlay').style.display = 'none';
                    jumpButton.classList.remove('loading');
                    jumpButton.innerHTML = originalContent;
                    jumpButton.disabled = false;
                  }
                }, 10000); // 10 second timeout
              } else {
                window.open(data.url, '_blank');
                // Hide loading overlay and restore button state immediately for external links
                document.querySelector('.loading-overlay').style.display = 'none';
                jumpButton.classList.remove('loading');
                jumpButton.innerHTML = originalContent;
                jumpButton.disabled = false;
              }
            }
          })
          .catch(error => {
            console.error('Error:', error);
            // Hide loading overlay and restore button state on error
            document.querySelector('.loading-overlay').style.display = 'none';
            jumpButton.classList.remove('loading');
            jumpButton.innerHTML = originalContent;
            jumpButton.disabled = false;
          });
      });

      // Share functionality
      shareButton.addEventListener('click', function () {
        const url = jumpIframe.src;
        if (!url || url === 'about:blank') {
          alert('No content to share.');
          return;
        }
        if (navigator.share) {
          navigator.share({
            title: 'Check this out!',
            url: url
          }).then(() => {
            console.log('Thanks for sharing!');
          }).catch(console.error);
        } else {
          // Fallback for browsers that do not support the Web Share API
          alert('Your browser does not support the Web Share API');
        }
      });

      // Close functionality for both close buttons
      closeButtons.forEach(function (button) {
        button.addEventListener('click', function () {
          jumpResult.style.display = 'none';
          jumpIframe.src = 'about:blank';
        });
      });

      // Search functionality
      searchBar.addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
          event.preventDefault();
          const query = searchBar.value.trim();
          if (!query) return;

          // Show loading overlay
          document.querySelector('.loading-overlay').style.display = 'flex';

          // Disable the search bar to prevent multiple submissions
          searchBar.disabled = true;

          fetch('/search?query=' + encodeURIComponent(query))
            .then(response => response.json())
            .then(data => {
              // Re-enable the search bar
              searchBar.disabled = false;

              // Hide loading overlay
              document.querySelector('.loading-overlay').style.display = 'none';

              if (data.error) {
                console.error('Search error:', data.error);
                alert('Error: ' + data.error);
                return;
              }
              if (data.url) {
                // Check if the URL can be embedded
                if (data.can_embed) {
                  jumpIframe.src = data.url;
                  jumpResult.style.display = 'block';

                  // Add event listener to detect when iframe is loaded
                  jumpIframe.onload = function () {
                    // Hide loading overlay
                    document.querySelector('.loading-overlay').style.display = 'none';
                  };

                  // Add timeout in case iframe fails to load
                  setTimeout(() => {
                    document.querySelector('.loading-overlay').style.display = 'none';
                  }, 10000); // 10-second timeout
                } else {
                  // Open the URL in a new tab if it cannot be embedded
                  window.open(data.url, '_blank');
                }
              } else {
                alert('No results found.');
              }
            })
            .catch(error => {
              // Re-enable the search bar
              searchBar.disabled = false;

              // Hide loading overlay
              document.querySelector('.loading-overlay').style.display = 'none';

              console.error('Error:', error);
              alert('An error occurred while searching.');
            });
        }
      });
      // Add pressed state handling for jump button
      jumpButton.addEventListener('mousedown', function () {
        this.classList.remove('hover:scale-105');
        this.classList.add('scale-95');
        this.style.boxShadow = 'inset 0 0 20px rgba(255, 255, 255, 0.5)';
      });

      jumpButton.addEventListener('mouseup', function () {
        this.classList.remove('scale-95');
        this.classList.add('hover:scale-105');
      });

      // Add this to your existing DOMContentLoaded event handler
      document.querySelectorAll('.toolbar-button').forEach(button => {
        button.addEventListener('touchstart', () => {
          if ('vibrate' in navigator) {
            navigator.vibrate(10); // Short vibration
          }

          // Trigger haptic feedback on iOS
          if ('ontouchstart' in document.documentElement) {
            const event = new Event('touchstart');
            event.force = 1;
            button.dispatchEvent(event);
          }
        }, { passive: true });
      });

      // Add specific haptic for jump button
      document.getElementById('jump-button').addEventListener('touchstart', () => {
        if ('vibrate' in navigator) {
          navigator.vibrate(15); // Slightly longer vibration for jump
        }

        // iOS haptic
        if ('ontouchstart' in document.documentElement) {
          const event = new Event('touchstart');
          event.force = 1;
          this.dispatchEvent(event);
        }
      }, { passive: true });
    });
  </script>
</body>

</html>