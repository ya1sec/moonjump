<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Moonjump</title>
  <!-- Meta tags -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- CSS -->
  <link rel="stylesheet" type="text/css" media="screen" href="/static/assets/css/hack.css" />
</head>

<body>
  <!-- Top Toolbar -->
  <div id="top-toolbar">
    <input type="search" id="search-bar" placeholder="Search...">
    <button id="info-button">Info</button>
  </div>

  <!-- Main Content -->
  <div id="main-content">
    <img id="logo" src="/static/assets/img/sun.svg" alt="Moonjump Logo">
  </div>

  <!-- Jump Result (Iframe) -->
  <div id="jump-result" style="display: none;">
    <button class="close-button">&times;</button>
    <div class="iframe-container">
      <iframe id="jump-iframe" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
    </div>
  </div>

  <!-- Info Section -->
  <div id="info-section" style="display: none;">
    <div id="info-content">
      <h2>About Moonjump</h2>
      <p>Moonjump is a server that redirects you to a random page harvested from the arcane depths of the web.</p>
      <!-- Add more informational content as needed -->
      <button id="close-info-button">Close</button>
    </div>
  </div>

  <!-- Bottom Toolbar -->
  <div id="bottom-toolbar">
    <button id="share-button">Share</button>
    <button id="jump-button">Jump</button>
    <button class="close-button">Close</button>
  </div>

  <!-- JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const jumpButton = document.getElementById('jump-button');
      const shareButton = document.getElementById('share-button');
      const closeButtons = document.querySelectorAll('.close-button');
      const jumpResult = document.getElementById('jump-result');
      const jumpIframe = document.getElementById('jump-iframe');
      const infoButton = document.getElementById('info-button');
      const searchBar = document.getElementById('search-bar');
      const infoSection = document.getElementById('info-section');

      // Jump functionality
      jumpButton.addEventListener('click', function () {
        fetch('/jump')
          .then(response => response.json())
          .then(data => {
            if (data.url) {
              if (data.can_embed) {
                jumpIframe.src = data.url;
                jumpResult.style.display = 'block';
              } else {
                window.open(data.url, '_blank');
              }
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
      });

      // Share functionality
      shareButton.addEventListener('click', function () {
        const url = jumpIframe.src;
        if (!url || url === 'about:blank') {
          alert('No content to share.');
          return;
        }
        if (navigator.share) {
          navigator.share({
            title: 'Check this out!',
            url: url
          }).then(() => {
            console.log('Thanks for sharing!');
          }).catch(console.error);
        } else {
          // Fallback for browsers that do not support the Web Share API
          alert('Your browser does not support the Web Share API');
        }
      });

      // Close functionality for both close buttons
      closeButtons.forEach(function (button) {
        button.addEventListener('click', function () {
          jumpResult.style.display = 'none';
          jumpIframe.src = 'about:blank';
        });
      });

      // Info button functionality
      infoButton.addEventListener('click', function () {
        infoSection.style.display = 'block';
      });

      // Close info section
      document.getElementById('close-info-button').addEventListener('click', function () {
        infoSection.style.display = 'none';
      });

      // Search functionality
      searchBar.addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
          event.preventDefault();
          const query = searchBar.value;
          fetch('/search?q=' + encodeURIComponent(query))
            .then(response => response.json())
            .then(data => {
              if (data.url) {
                jumpIframe.src = data.url;
                jumpResult.style.display = 'block';
              }
            })
            .catch(error => {
              console.error('Error:', error);
            });
        }
      });
    });
  </script>
</body>

</html>